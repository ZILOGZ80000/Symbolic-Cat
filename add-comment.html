<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</title>
    <style>
        :root {
            --dark-purple: #4b0082;
            --background-color: #000000;
            --text-color: #ffffff;
            --hover-effect: rgba(75, 0, 130, 0.2);
            --dark-blue: #00008b;
        }

        html, body {
            max-width: 100vw;
            overflow-x: hidden;
            margin: 0;
            padding: 0;
            background: var(--background-color);
            color: var(--text-color);
            font-family: 'Arial', sans-serif;
            line-height: 1.6;
        }

        .container {
            max-width: 600px;
            margin: 2rem auto;
            padding: 20px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 10px;
            border: 1px solid rgba(75, 0, 130, 0.3);
        }

        input, textarea {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--dark-purple);
            color: white;
            border-radius: 5px;
        }

        button {
            background: var(--dark-purple);
            color: white;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            margin-top: 10px;
        }

        .nick-info {
            color: #aaa;
            font-size: 0.9em;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>–ù–æ–≤—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</h2>
        <div class="nick-info" id="nickInfo"></div>

        <form id="commentForm">
        <div id="nickContainer">
            <h4>–¢–≤–æ–π –Ω–∏–∫: <span  id="nick"></span>
                <!--<input type="text" 
                       id="nickname" 
                       placeholder="–¢–≤–æ–π —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –Ω–∏–∫"
                       required>-->
            
                
            </div>

            <textarea id="comment" 
                      rows="5" 
                      placeholder="–¢–µ–∫—Å—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è..."
                      required></textarea>

            <button type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
            <button onclick="window.location.href='index.html'">–û—Ç–º–µ–Ω–∞</button>
        </form>
    </div>

<script>
document.addEventListener('DOMContentLoaded', async () => {
    const nickname = localStorage.getItem('userNick');
    document.getElementById("nick").text = nickname;

    async function sendComment(text) {
        try {
            // 1. –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
            const currentResponse = await fetch(`.netlify/functions/get-comments`, {
            });


            const currentData = await currentResponse.json();
            const currentComments = currentData.record ? [...currentData.record] : [];

            // 2. –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
            currentComments.push(`${nickname}: ${text}`);

            // 3. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –û–ë–ù–û–í–õ–Å–ù–ù–´–ô –º–∞—Å—Å–∏–≤
            await fetch(`.netlify/functions/add-comment.js`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(currentComments)
            });

            alert('‚úÖ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –¥–æ–±–∞–≤–ª–µ–Ω!');
            window.location.href = 'index.html';

        } catch (error) {
            console.error('–û—à–∏–±–∫–∞:', error);
            alert('üö® –ü—Ä–æ–≤–µ—Ä—å –∫–æ–Ω—Å–æ–ª—å –¥–ª—è –¥–µ—Ç–∞–ª–µ–π –æ—à–∏–±–∫–∏');
        }
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ñ–æ—Ä–º—ã
    document.getElementById('commentForm').addEventListener('submit', (e) => {
        e.preventDefault();
        const commentText = document.getElementById('comment').value.trim();
        if (commentText) sendComment(commentText);
    });
});
</script>

</body>
</html>
